<!DOCTYPE html>
<html lang="ko">
  <head>
    <%- include('./layout/head') %>
    <title>평화나라 - 공지사항 글쓰기</title>
  </head>
  <body>
    <div class="wrap">
      <header><%- include('./layout/header') %></header>
      <div class="container">
        <form
          action="/noticeWrite"
          method="post"
          onsubmit="return onWriteSubmit();"
        >
          <div class="form-group">
            <label class="font-weight-bold" for="title">제목</label>
            <input
              type="text"
              class="form-control"
              placeholder="제목을 입력하세요."
              name="title"
              id="title"
            />
          </div>
          <div class="form-group">
            <label class="font-weight-bold" for="content">내용</label>
            <textarea
              class="form-control"
              name="content"
              id="summernote"
              cols="30"
              rows="10"
            ></textarea>
          </div>
          <div class="form-group d-flex justify-content-end">
            <input type="submit" class="btn btn-primary" value="등록" />
          </div>
        </form>
      </div>
      <footer><%- include('./layout/footer') %></footer>
    </div>

    <script>
      $(document).ready(function () {
        console.log($.summernote.options);
        // 실행시 언어 설정을 한글로 설정
        $.summernote.options.lang = "ko-KR";
        $.summernote.options.airMode = false;

        $("#summernote").summernote({
          placeholder: "중거 거래 사이트 - 평화나라",
          tabsize: 2,
          height: 500,
          focus: true,
          lang: "ko-KR",
          callbacks: {
            onImageUpload: function (files, editor, welEditable) {
              for (var i = files.length - 1; i >= 0; i--) {
                sendFile(files[i], this);
              }
            },
          },
        });
      });

      function sendFile(file, el) {
        var form_data = new FormData();
        form_data.append("file", file);
        $.ajax({
          data: form_data,
          type: "POST",
          url: "./img",
          cache: false,
          contentType: false,
          enctype: "multipart/form-data",
          processData: false,
          success: function (img_name) {
            $(el).summernote("editor.insertImage", img_name);
          },
        });
      }
      function onWriteSubmit() {
        if ($("#title").val().trim() == "") {
          var message = "제목을 입력해 주세요";
          $("#title").val("");
          $("#title").focus();
          alert(message);
          return false;
        }

        if ($("#summernote").val().trim() == "") {
          var message = "본문 내용을 입력해 주세요";
          $("#summernote").val("");
          $("#summernote").focus();
          alert(message);
          return false;
        }
      }
    </script>
  </body>
</html>
